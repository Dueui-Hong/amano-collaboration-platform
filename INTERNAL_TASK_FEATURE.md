# 팀 내부 업무 등록 및 관리 기능

## 📋 개요

팀원과 관리자가 시스템 내에서 직접 업무를 등록하고 관리할 수 있는 기능입니다.
외부 요청 폼과는 별도로, 로그인한 사용자만 접근 가능한 내부 업무 관리 시스템입니다.

---

## 🔐 권한별 기능

### **1. 팀원 (Member)**

#### ✅ 가능한 작업
- **본인 업무 등록**: 팀원 대시보드에서 "새 업무 등록" 버튼 클릭
- **본인 업무 조회**: 본인에게 배정된 업무만 캘린더/리스트에 표시
- **본인 업무 수정**: 상태 변경 (Todo → Doing → Done)
- **결과물 업로드**: 업무 완료 시 결과 이미지 업로드

#### ❌ 불가능한 작업
- 다른 팀원의 업무 조회
- 다른 팀원의 업무 생성
- 업무 삭제

#### 🎯 사용 시나리오
1. 팀원이 본인의 개인 프로젝트/업무를 등록
2. 본인 캘린더에서 업무 진행 상황 관리
3. 업무 완료 후 결과물 이미지 업로드

---

### **2. 관리자 (Admin)**

#### ✅ 가능한 작업
- **모든 업무 조회**: 전체 팀원의 업무 확인 가능
- **업무 생성**: 관리자 대시보드에서 업무 생성 및 팀원 배정
- **업무 수정**: 상태 변경, 배정자 변경
- **업무 삭제**: 업무 상세 페이지에서 삭제 버튼 사용

#### 🎯 사용 시나리오
1. 관리자가 전체 팀원의 업무 현황 파악
2. 미배정 업무를 Drag & Drop으로 팀원에게 배정
3. 불필요한 업무 삭제 (상세 페이지에서 "업무 삭제" 버튼)

---

## 🚀 사용 방법

### **팀원: 새 업무 등록**

1. **로그인**
   - 팀원 계정으로 로그인 (예: `dueui_hong@amano.co.kr` / `1111`)

2. **대시보드 접속**
   - 로그인 후 자동으로 `/dashboard` (개인 캘린더)로 이동

3. **새 업무 등록 버튼 클릭**
   - 우측 상단 "새 업무 등록" 버튼 (파란색) 클릭
   - 모달 팝업 표시

4. **업무 정보 입력**
   - **업무 제목** (필수): 예) "홈페이지 배너 디자인"
   - **카테고리** (필수): 디자인/기획/홍보/콘텐츠/영상/행사/기타
   - **요청 부서** (선택): 비워두면 본인 부서 자동 입력
   - **담당자 이름** (선택): 비워두면 본인 이름 자동 입력
   - **마감일** (필수): 날짜 선택
   - **업무 상세 내용** (선택): 상세 설명 입력

5. **등록 버튼 클릭**
   - 입력 검증 후 업무 생성
   - **자동으로 본인에게 배정됨**
   - 캘린더에 즉시 반영

6. **업무 진행 관리**
   - 캘린더에서 업무 클릭 → 상태 변경 (Todo/Doing/Done)
   - 상세 페이지에서 결과물 이미지 업로드

---

### **관리자: 업무 삭제**

1. **로그인**
   - 관리자 계정으로 로그인 (예: `minseok_kim1@amano.co.kr` / `1111`)

2. **업무 상세 페이지 접속**
   - 관리자 대시보드에서 업무 카드 클릭
   - 또는 URL: `/tasks/[업무ID]`

3. **업무 삭제**
   - 우측 상단 "업무 삭제" 버튼 (빨간색) 클릭
   - 삭제 확인 다이얼로그 표시
   - **"삭제" 버튼 클릭**
   - 업무가 영구적으로 삭제됨 (복구 불가)

---

## 🎨 UI/UX 특징

### **팀원 대시보드**
- **새 업무 등록 버튼**
  - 위치: 헤더 우측 상단
  - 스타일: 아마노코리아 브랜드 컬러 그라디언트 (#0081C0 → #005A8D)
  - 아이콘: ➕ (Add Icon)

- **업무 등록 모달**
  - Material-UI Dialog 사용
  - 필수 입력 필드: 제목, 카테고리, 마감일
  - 선택 입력 필드: 요청 부서, 담당자 이름, 상세 내용
  - 기본값 자동 입력 (본인 부서/이름)
  - 입력 검증 및 에러 메시지

### **업무 상세 페이지**
- **삭제 버튼 (관리자만 표시)**
  - 위치: 헤더 우측 상단 (뒤로가기 버튼 옆)
  - 스타일: 빨간색 Outlined 버튼
  - 아이콘: 🗑️ (Delete Icon)

- **삭제 확인 다이얼로그**
  - 삭제 아이콘 (64px, 빨간색)
  - 확인 메시지: "업무를 삭제하시겠습니까?"
  - 경고 문구: "삭제된 업무는 복구할 수 없습니다."
  - 취소/삭제 버튼

---

## 🔒 보안 및 권한 검증

### **프론트엔드 (UI)**
- 팀원: "새 업무 등록" 버튼만 표시
- 관리자: "업무 삭제" 버튼 추가 표시

### **백엔드 (Supabase RLS)**
- **팀원**
  - `SELECT`: 본인 업무만 조회 (`assignee_id = auth.uid()`)
  - `INSERT`: 본인에게 배정되는 업무만 생성
  - `UPDATE`: 본인 업무만 수정
  - `DELETE`: 불가

- **관리자**
  - `SELECT`: 모든 업무 조회
  - `INSERT`: 모든 업무 생성
  - `UPDATE`: 모든 업무 수정
  - `DELETE`: 모든 업무 삭제

---

## 📊 데이터 흐름

### **업무 생성 (팀원)**
```
1. 팀원 대시보드 → "새 업무 등록" 버튼 클릭
2. 모달 폼 입력
3. "등록" 버튼 클릭
4. 입력 검증 (제목/카테고리/마감일 필수)
5. Supabase INSERT (본인 ID로 assignee_id 설정)
6. 성공 시 Snackbar 표시 + 모달 닫기 + 데이터 새로고침
7. 캘린더에 새 업무 자동 표시
```

### **업무 삭제 (관리자)**
```
1. 관리자가 업무 상세 페이지 접속
2. "업무 삭제" 버튼 클릭
3. 삭제 확인 다이얼로그 표시
4. "삭제" 버튼 클릭
5. 권한 검증 (role === 'admin')
6. Supabase DELETE
7. 성공 시 Snackbar 표시 + 1초 후 대시보드로 리다이렉트
```

---

## 🗂️ 파일 구조

### **수정된 파일**
1. **`src/app/dashboard/page.tsx`** (팀원 대시보드)
   - `useState`: `showNewTaskModal`, `newTask`, `creatingTask` 추가
   - `createNewTask()`: 새 업무 생성 함수
   - `handleNewTaskChange()`: 폼 입력 핸들러
   - UI: "새 업무 등록" 버튼 + 모달 추가

2. **`src/app/tasks/[id]/page.tsx`** (업무 상세 페이지)
   - `useState`: `deleteConfirmOpen`, `deleting` 추가
   - `deleteTask()`: 업무 삭제 함수
   - UI: "업무 삭제" 버튼 (관리자만) + 삭제 확인 다이얼로그 추가

---

## ✅ 테스트 시나리오

### **시나리오 1: 팀원 업무 등록**
1. 팀원 로그인 (`dueui_hong@amano.co.kr` / `1111`)
2. 대시보드에서 "새 업무 등록" 버튼 클릭
3. 폼 입력:
   - 제목: "홈페이지 배너 디자인"
   - 카테고리: "디자인"
   - 마감일: 내일 날짜
   - 상세 내용: "메인 페이지 상단 배너 제작"
4. "등록" 버튼 클릭
5. ✅ 성공 메시지 표시
6. ✅ 캘린더에 새 업무 자동 표시
7. ✅ 업무 클릭 → 상세 페이지에서 정보 확인

### **시나리오 2: 팀원 권한 제한**
1. 팀원 로그인
2. 다른 팀원의 업무 상세 페이지 접속 시도
3. ❌ 접근 불가 (본인 업무만 조회)
4. ✅ "업무 삭제" 버튼 미표시

### **시나리오 3: 관리자 업무 삭제**
1. 관리자 로그인 (`minseok_kim1@amano.co.kr` / `1111`)
2. 관리자 대시보드에서 업무 카드 클릭
3. 업무 상세 페이지에서 "업무 삭제" 버튼 확인
4. "업무 삭제" 버튼 클릭
5. 삭제 확인 다이얼로그 표시
6. "삭제" 버튼 클릭
7. ✅ 성공 메시지 표시
8. ✅ 1초 후 관리자 대시보드로 이동
9. ✅ 삭제된 업무가 목록에서 제거됨

---

## 🔄 기존 기능과의 차이점

### **공개 요청 폼 (`/request`)**
- **대상**: 외부 부서 (비로그인 사용자)
- **목적**: 기획홍보팀에 업무 요청
- **배정**: 미배정 상태로 생성 → 관리자가 수동 배정
- **접근**: 누구나 접근 가능 (로그인 불필요)

### **팀 내부 업무 등록 (새로 추가)**
- **대상**: 로그인한 팀원/관리자
- **목적**: 본인 업무 직접 등록 및 관리
- **배정**: 생성 시 본인에게 자동 배정
- **접근**: 로그인 필수

---

## 📝 주요 코드 스니펫

### **팀원: 새 업무 생성 함수**
```typescript
const createNewTask = async () => {
  if (!userInfo) return;

  // 필수 입력 검증
  if (!newTask.title || !newTask.category || !newTask.due_date) {
    showSnackbar('제목, 카테고리, 마감일은 필수 입력입니다.', 'error');
    return;
  }

  setCreatingTask(true);

  try {
    const { error } = await supabase.from('tasks').insert({
      title: newTask.title,
      category: newTask.category,
      requester_dept: newTask.requester_dept || userInfo.department || '기획홍보팀',
      requester_name: newTask.requester_name || userInfo.name,
      description: newTask.description,
      due_date: newTask.due_date,
      status: 'Todo',
      assignee_id: userInfo.id, // 본인에게 자동 배정
      image_urls: [],
    });

    if (error) throw error;

    showSnackbar('새 업무가 등록되었습니다!', 'success');
    // ... 모달 닫기 및 새로고침
  } catch (error) {
    console.error('업무 생성 실패:', error);
    showSnackbar('업무 생성에 실패했습니다.', 'error');
  } finally {
    setCreatingTask(false);
  }
};
```

### **관리자: 업무 삭제 함수**
```typescript
const deleteTask = async () => {
  if (!task || !userInfo) return;

  // 권한 확인: 관리자만 삭제 가능
  if (userInfo.role !== 'admin') {
    showSnackbar('관리자만 업무를 삭제할 수 있습니다.', 'error');
    return;
  }

  setDeleting(true);

  try {
    const { error } = await supabase
      .from('tasks')
      .delete()
      .eq('id', task.id);

    if (error) throw error;

    showSnackbar('업무가 삭제되었습니다.', 'success');
    
    // 관리자는 관리자 대시보드로
    setTimeout(() => {
      router.push('/admin/dashboard');
    }, 1000);
  } catch (error) {
    console.error('업무 삭제 실패:', error);
    showSnackbar('업무 삭제에 실패했습니다.', 'error');
  } finally {
    setDeleting(false);
    setDeleteConfirmOpen(false);
  }
};
```

---

## 🎉 완성된 기능

✅ **팀원: 본인 업무 등록 및 관리**
✅ **관리자: 모든 업무 조회/수정/삭제**
✅ **권한 기반 UI 표시**
✅ **입력 검증 및 에러 처리**
✅ **사용자 친화적 UX (모달, 다이얼로그, Snackbar)**
✅ **브랜드 디자인 시스템 통일**

---

## 📞 문의

- 추가 기능 요청
- 버그 리포트
- UI/UX 개선 제안

→ 홍두의 기획홍보팀 담당자에게 문의
